<html lang="en"> 
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DPlayer - Video Player</title>
<script src="https://cdn.jsdelivr.net/npm/dplayer@1.27.1/dist/DPlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.15/dist/hls.min.js"></script>
<link href="https://www.hls-player.net/fav.png" rel="icon" type="image/x-icon"/>
<style>
  .video-con {
    position: relative;
    width: 100%;
    height: 100vh;
  }
  .join-us {
    position: absolute;
    z-index: 1000;
    top: 6px;
    left: 5px;
    height: 30px;
    width: 90px;
    color: rgb(204, 204, 204);
    border: 2px solid rgb(204, 204, 204);
    padding: 1px 0;
    border-radius: 2px;
    text-align: center;
    background: rgba(0, 0, 0, 0.5);
    cursor: pointer;
    text-decoration: none;
  }
  body {
    margin: 0;
    padding: 0;
  }
  .error-message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: red;
    font-size: 18px;
    z-index: 1000;
    text-align: center;
  }
</style>
</head>
<body>
<div class="video-con">
  <meta content="no-referrer" name="referrer">
  <div id="dplayer"></div>
  <a class="join-us" href="https://t.me/zobitv">Join Us</a>
  <div id="error-message" class="error-message" style="display: none;"></div>
</div>
<script>
  function getQueryParam(param) {
    try {
      const queryParams = new URLSearchParams(window.location.search);
      return queryParams.get(param);
    } catch (e) {
      console.error('Error parsing query parameters:', e);
      return null;
    }
  }

  function showError(message) {
    const errorDiv = document.getElementById('error-message');
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
  }

  const videoSource = getQueryParam('url');

  if (!videoSource) {
    showError('No video URL provided in the query parameter.');
    throw new Error('No video URL provided');
  }

  let dp;
  try {
    dp = new DPlayer({
      container: document.getElementById('dplayer'),
      autoplay: true,
      muted: true,
      video: {
        url: videoSource,
        type: 'hls'
      },
      logo: 'https://i.postimg.cc/rsjvddTg/ztvlogo-removebg-preview.png',
      logoLink: 'https://t.me/zobitv',
      logoPosition: 'top-right',
      contextmenu: [
        {
          text: 'Join Us',
          link: 'https://t.me/zobitv'
        }
      ]
    });

    // Handle HLS playback
    if (typeof Hls !== 'undefined' && Hls.isSupported()) {
      const hls = new Hls({
        enableWorker: true,
        maxBufferLength: 30
      });
      hls.loadSource(videoSource);
      hls.attachMedia(dp.video);
      hls.on(Hls.Events.ERROR, (event, data) => {
        console.error('HLS error:', data);
        showError('Failed to load video stream. Please check the URL or try again later.');
      });
    } else if (dp.video.canPlayType('application/vnd.apple.mpegurl')) {
      // Native HLS support (e.g., Safari)
      dp.video.src = videoSource;
    } else {
      showError('Your browser does not support HLS playback.');
    }

    // Handle DPlayer errors
    dp.on('error', () => {
      showError('Error playing the video. Please check the video source.');
    });

  } catch (error) {
    console.error('DPlayer initialization error:', error);
    showError('Failed to initialize video player.');
  }
</script>
</body>
</html>
